<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Estoque</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="storage-page">
    <div class="upper-bar">
        <button onclick="showForm('addProductForm')">Adicionar Produtos</button>
        <button onclick="showForm('removeProductForm')">Remover Produtos</button>
        <button onclick="showForm('updateProductForm')">Atualizar Produtos</button>
        <button onclick="showForm('viewProducts')">Ver Produtos</button>
    </div>

    <div class="welcome-section">
        <h1>Bem-vindo {{ user }} ao Estoque</h1> 
        <button onclick="window.location.href='{{ url_for('home') }}';">Sair</button>
    </div>

    <div id="formContainer-products" style="display: none;">
        <div id="addProductForm" class="form" style="display:none;">
            <h2>Adicionar Produto</h2>
            <form id="addProduct" onsubmit="submitForm(event, '/products/add');">
                <label for="barcode">Código de barras:</label>
                <input type="text" id="barcode" name="barcode" required>
                <label for="productName">Nome do Produto:</label>
                <input type="text" id="productName" name="productName" required>
                <label for="buyPrice">Preço de compra:</label>
                <input type="number" id="buyPrice" name="buyPrice" required step="0.01" min="0">
                <label for="sellPrice">Preço de venda:</label>
                <input type="number" id="sellPrice" name="sellPrice" required step="0.01" min="0">
                <label for="productQuantity">Quantidade do Produto:</label>
                <input type="number" id="productQuantity" name="productQuantity" required step="1" min="0">
                <label for="expirationDate">Data de validade:</label>
                <div class="select-container-data" required>
                    <select name="month" required>
                        <option value="">Mês</option>
                        {% set months = {
                            1: "Janeiro", 2: "Fevereiro", 3: "Março",
                            4: "Abril", 5: "Maio", 6: "Junho",
                            7: "Julho", 8: "Agosto", 9: "Setembro",
                            10: "Outubro", 11: "Novembro", 12: "Dezembro"
                        } %}
                        {% for month in range(1, 13) %}
                            <option value="{{ "%02d"|format(month) }}">{{ months[month] }}</option>
                        {% endfor %}
                    </select>
                    <select name="year" required>
                        <option value="">Ano</option>
                        {% for year in range(2022, 2032) %}
                        <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                </div>
                <input type="submit" value="Adicionar">
            </form>
        </div>

        <div id="removeProductForm" class="form" style="display:none;">
            <h2>Remover Produto</h2>
            <form id="removeProduct" onsubmit="submitForm(event, '/products/remove');">
                <label for="productId">ID do Produto:</label>
                <input type="text" id="productId" name="productId" required>
                <input type="submit" value="Remover">
            </form>
        </div>

        <div id="updateProductForm" class="form" style="display:none;">
            <h2>Atualizar Produto</h2>
            <form id="updateProduct" onsubmit="submitForm(event, '/products/update');">
                <label for="updateProductId">ID do Produto:</label>
                <input type="text" id="updateProductId" name="updateProductId" required>
                <label for="updateProductName">Novo Nome:</label>
                <input type="text" id="updateProductName" name="updateProductName" required>
                <input type="submit" value="Atualizar">
            </form>
        </div>

        <div id="viewProducts" class="form" style="display:none;">
            <h2>Produtos</h2>
            <div id="productList"></div>
        </div>
    </div>

    <script>
        function showForm(formId) {
            // Exibe o contêiner do formulário
            $('#formContainer-products').show();
            // Oculta todos os formulários
            $('.form').hide();
            // Exibe o formulário selecionado
            $('#' + formId).show();
        }

        function submitForm(event, actionUrl) {
            event.preventDefault(); // Impede o envio normal do formulário

            const formData = $(event.target).serialize(); // Obtém os dados do formulário

            $.ajax({
                type: 'POST',
                url: actionUrl,
                data: formData,
                success: function(response) {
                    // Aqui você pode adicionar lógica para manipular a resposta
                    alert(response.message);
                    loadProducts(); // Recarrega a lista de produtos
                },
                error: function(error) {
                    alert("Erro ao processar a requisição.");
                }
            });
        }

        function loadProducts() {
            $.ajax({
                url: '/products',
                type: 'GET',
                success: function(products) {
                    let productList = $('#productList');
                    productList.empty(); // Limpa a lista antes de adicionar
                    products.forEach(product => {
                        productList.append('<div>' + product.name + ' (ID: ' + product.id + ')</div>');
                    });
                },
                error: function(error) {
                    alert("Erro ao carregar produtos.");
                }
            });
        }

        // Carrega a lista de produtos ao iniciar a página
        $(document).ready(function() {
            loadProducts();
        });
    </script>
</body>
</html>
